# Микрофронтенды для текущего стека
## Уровень 1. Проектирование
### Оценка сложности и масштаба приложения.
#### Приложение: 
Mesto.
#### Функциональные возможности:
- Загрузка и удаление фотографий
- Создание, удаление, редактирование профиля
- Авторизация
- Сбор и учет лайков на фотографиях
#### Сложность: 
В текущем состоянии сложность приложения очень низкая, 
так как функционал является ограниченным. Однако, у приложения большая перспектива роста и развития. 
Добавление новых функций может заметно увеличить сложность приложения. 
Поэтому данный этап развития приложения можно считать переходом от MVP к разработке полноценного приложения 
а-ля Pinterest или Instagram.
Отсюда и возникает необходимость в начале полноценной разработки сделать архитектурное решение, 
позволяющее в будущем расширять функционал приложения с минимальными издержками. 
#### Масштаб: 
В текущем состоянии масштаб приложения скромен, однако, если учесть пункт выше, можно сделать вывод, 
что в будущем ситуация изменится. При этом данное приложение из-за своей специфики может иметь пиковые нагрузки 
в определенные периоды, например, в праздники.
### Определение бизнес-функций приложения
Основываясь на принципах DDD и функциональных возможностях приложения, в качестве стратегии проектирования возможно применить 
стратегию "Вертикальная нарезка". 
В таком случае приложение можно разделить на следующие домены/зоны: 
- **Авторизация** - отвечает за log in/log out пользователя в приложении и регистрацию аккаунта
- **Управление ЖЦ фотографий** - отвечает за загрузку, хранение и удаление фотографий, а также их характеристик
- **Управление ЖЦ профиля** - отвечает за редактирование и хранение состояния профиля в системе, а также его характеристик
#### Проблематика определения доменов приложения
1. Необходимо ли выделить систему учета лайков на фотографии в отдельный домен? Вероятно, да. Так как "лайк" принадлежит не только фотографии, 
но и пользователю. То есть количество лайков на фото и кто их поставил - характеристика фото. Количество поставленных лайков и фотографии, на которых они стоят -
характеристика пользователя. Однако, даже если на бекенде это будет отдельный домен, то для фронтенда 
отдельный микрофронтенд для этого не выделить.

**В итоге решено оставить состав доменов равным составу микрофронтендов (помимо хоста и микрофронтенда-донора общих элементов) приложения для наглядности связи с бекендом.** 
### Выбор метода реализации
В качестве метода реализации выбран runtime с клиентской или гибридной композицией. Можно начать с клиентской, а по мере необходимости добавить серверную часть, если придут такие требования к системе, которые реализуются через нее. 
Причины выбора:
- Приложение разделено на независимые части, которые необходимо независимо масштабировать и разворачивать
- Вероятно, будет применение разных технологических стеков
### Выбор инструмента реализации
В качестве инструмента выбирая между Single SPA и Webpack Module Federation (WMF) выбран WMF. Оба фреймворка подходят под решение поставленных задач, выбор сделан интуитивно, так как опыта нет ни в том, ни в том. Вероятно, использование WMF принесет пользу через возможности использовать приложениями функций друг друга. 
### Настройка межмодульного взаимодействия
Для определения стратегии межмодульного взаимодействия необходимо определить: 

- есть ли реакция частей системы на события происходящие в других модулях
- есть ли общее глобальное состояние

На данном этапе развития достаточно использовать только изолированные модули, общающиеся по апи с бекендом, однако в будущем при развитии приложения, необходимо будет иметь общий контекст на приложении для минимизации запросов на бекенд (авторизован ли пользователь для операции, например). Или имеет ли пользователь привилегии, которые меняют отображение каких-то элементов системы. Все зависит от развития приложения, но уже сейчас можно задать вектор развития и подключить библиотеку глобального состояния Redux.

### Итог
В итоге текущее монолитное приложение разбивается на 5 независимых модулей:

- auth - отвечает за домен пользователя. Регистрация, авторизация и аутентификация, удаление. Задает уникальный идентификатор пользователя при создании, который потом связывает все характеристики пользователя в системе. Для пользователя это входная точка в системе
- host - root модуль, содержащий неизменяемые части приложения (футер, хедер) и объединяющий все модули в единое приложение
- media - загрузка, отображение, удаление медиа файлов. Отображение характеристик медиа, таких как лайки и комментарии, дата загрузки
- profile - отображение и редактирование профиля пользователя
- shared - общие компоненты, которые сервис-донор предоставляет остальным модулям
## Уровень 2. Планирование изменений
Планируемая декомпозиция приложения в итоге выглядит так:

```angular2html
microfrontend
├── .gitkeep
├── auth-microfrontend
│   ├── package-lock.json
│   ├── package.json
│   ├── public
│   │   └── index.html
│   ├── src
│   │   ├── blocks
│   │   │   ├── auth-form
│   │   │   │   ├── __button
│   │   │   │   │   └── auth-form__button.css
│   │   │   │   ├── __form
│   │   │   │   │   └── auth-form__form.css
│   │   │   │   ├── __input
│   │   │   │   │   └── auth-form__input.css
│   │   │   │   ├── __link
│   │   │   │   │   └── auth-form__link.css
│   │   │   │   ├── __text
│   │   │   │   │   └── auth-form__text.css
│   │   │   │   ├── __textfield
│   │   │   │   │   └── auth-form__textfield.css
│   │   │   │   ├── __title
│   │   │   │   │   └── auth-form__title.css
│   │   │   │   └── auth-form.css
│   │   │   └── login
│   │   │       └── login.css
│   │   ├── components
│   │   │   ├── InfoTooltip.js
│   │   │   ├── Login.js
│   │   │   ├── ProtectedRoute.js
│   │   │   └── Register.js
│   │   ├── index.css
│   │   ├── index.js
│   │   └── utils
│   │       └── auth.js
│   └── webpack.config.js
├── host-microfrontend
│   ├── package-lock.json
│   ├── package.json
│   ├── public
│   │   └── index.html
│   ├── src
│   │   ├── blocks
│   │   │   ├── content
│   │   │   │   └── content.css
│   │   │   ├── footer
│   │   │   │   ├── __copyright
│   │   │   │   │   └── footer__copyright.css
│   │   │   │   └── footer.css
│   │   │   ├── header
│   │   │   │   ├── __auth-link
│   │   │   │   │   └── header__auth-link.css
│   │   │   │   ├── __logo
│   │   │   │   │   └── header__logo.css
│   │   │   │   ├── __logout
│   │   │   │   │   └── header__logout.css
│   │   │   │   ├── __user
│   │   │   │   │   └── header__user.css
│   │   │   │   ├── __wrapper
│   │   │   │   │   └── header__wrapper.css
│   │   │   │   └── header.css
│   │   │   └── page
│   │   │       ├── __content
│   │   │       │   └── page__content.css
│   │   │       ├── __section
│   │   │       │   └── page__section.css
│   │   │       └── page.css
│   │   ├── components
│   │   │   ├── App.js
│   │   │   ├── Footer.js
│   │   │   ├── Header.js
│   │   │   └── Main.js
│   │   ├── index.css
│   │   └── index.js
│   └── webpack.config.js
├── media-microfrontend
│   ├── package-lock.json
│   ├── package.json
│   ├── public
│   │   └── index.html
│   ├── src
│   │   ├── blocks
│   │   │   ├── card
│   │   │   │   ├── __delete-button
│   │   │   │   │   ├── _hidden
│   │   │   │   │   │   └── card__delete-button_hidden.css
│   │   │   │   │   ├── _visible
│   │   │   │   │   │   └── card__delete-button_visible.css
│   │   │   │   │   └── card__delete-button.css
│   │   │   │   ├── __description
│   │   │   │   │   └── card__description.css
│   │   │   │   ├── __image
│   │   │   │   │   └── card__image.css
│   │   │   │   ├── __like-button
│   │   │   │   │   ├── _is-active
│   │   │   │   │   │   └── card__like-button_is-active.css
│   │   │   │   │   └── card__like-button.css
│   │   │   │   ├── __like-count
│   │   │   │   │   └── card__like-count.css
│   │   │   │   ├── __title
│   │   │   │   │   └── card__title.css
│   │   │   │   └── card.css
│   │   │   └── places
│   │   │       ├── __item
│   │   │       │   └── places__item.css
│   │   │       ├── __list
│   │   │       │   └── places__list.css
│   │   │       └── places.css
│   │   ├── components
│   │   │   ├── AddPlacePopup.js
│   │   │   ├── Card.js
│   │   │   └── ImagePopup.js
│   │   ├── index.css
│   │   └── index.js
│   └── webpack.config.js
├── profile-microfrontend
│   ├── package-lock.json
│   ├── package.json
│   ├── public
│   │   └── index.html
│   ├── src
│   │   ├── blocks
│   │   │   └── profile
│   │   │       ├── __add-button
│   │   │       │   └── profile__add-button.css
│   │   │       ├── __description
│   │   │       │   └── profile__description.css
│   │   │       ├── __edit-button
│   │   │       │   └── profile__edit-button.css
│   │   │       ├── __image
│   │   │       │   └── profile__image.css
│   │   │       ├── __info
│   │   │       │   └── profile__info.css
│   │   │       ├── __title
│   │   │       │   └── profile__title.css
│   │   │       └── profile.css
│   │   ├── components
│   │   │   ├── EditAvatarPopup.js
│   │   │   └── EditProfilePopup.js
│   │   ├── index.css
│   │   └── index.js
│   └── webpack.config.js
└── shared-microfrontend
├── package-lock.json
├── package.json
├── public
│   └── index.html
├── src
│   ├── blocks
│   │   └── popup
│   │       ├── __button
│   │       │   ├── _disabled
│   │       │   │   └── popup__button_disabled.css
│   │       │   └── popup__button.css
│   │       ├── __caption
│   │       │   └── popup__caption.css
│   │       ├── __close
│   │       │   └── popup__close.css
│   │       ├── __content
│   │       │   ├── _content
│   │       │   │   └── popup__content_content_image.css
│   │       │   └── popup__content.css
│   │       ├── __error
│   │       │   ├── _visible
│   │       │   │   └── popup__error_visible.css
│   │       │   └── popup__error.css
│   │       ├── __form
│   │       │   └── popup__form.css
│   │       ├── __icon
│   │       │   └── popup__icon.css
│   │       ├── __image
│   │       │   └── popup__image.css
│   │       ├── __input
│   │       │   ├── _type
│   │       │   │   └── popup__input_type_error.css
│   │       │   └── popup__input.css
│   │       ├── __label
│   │       │   └── popup__label.css
│   │       ├── __status-message
│   │       │   └── popup__status-message.css
│   │       ├── __title
│   │       │   └── popup__title.css
│   │       ├── _is-opened
│   │       │   └── popup_is-opened.css
│   │       ├── _type
│   │       │   ├── popup_type_edit-avatar.css
│   │       │   └── popup_type_remove-card.css
│   │       └── popup.css
│   ├── components
│   │   └── PopupWithForm.js
│   ├── contexts
│   │   └── CurrentUserContext.js
│   ├── index.css
│   ├── index.js
│   └── utils
│       └── api.js
└── webpack.config.js
```